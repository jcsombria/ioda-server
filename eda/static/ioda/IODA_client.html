<!doctype html>
<html lang="en">
	<head>
		<!------------------------>
		<!-- Required meta tags -->
		<!------------------------>

		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<!-- Adapted from example by 
		<meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
		<meta name="generator" content="Hugo 0.79.0">
		<link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/cheatsheet/">
		<link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/sign-in/">
		-->
		<title>Fusion IODA</title>

		<!------------------------>
		<!-- LIBRARY CSS        -->
		<!------------------------>

		<link rel="stylesheet" href="css/bootstrap.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
				
		<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
		<!-- link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous"-->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
		
		<!--  
		<link href="https://cdn.jsdelivr.net/npm/jspanel4@4.11.1/dist/jspanel.css" rel="stylesheet">
		-->
		
		<link href="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/css/suneditor.min.css" rel="stylesheet">
		<!-- <link href="https://cdn.jsdelivr.net/npm/suneditor@latest/assets/css/suneditor.css" rel="stylesheet"> -->
		<!-- <link href="https://cdn.jsdelivr.net/npm/suneditor@latest/assets/css/suneditor-contents.css" rel="stylesheet"> -->
		<!------------------------>
		<!-- IODA CSS           -->
		<!------------------------>

		<link rel="stylesheet" href="css/ioda.css">

		<!------------------------>
		<!-- LIBRARY JS         -->
		<!------------------------>

		<!--  script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script-->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
		<script src="https://code.jquery.com/jquery-1.12.4.js" ></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		
		<!-- Code Editor textarea -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.13/ace.js" type="text/javascript" charset="utf-8"></script>

		<!-- jsPanel JavaScript >
		<script src="https://cdn.jsdelivr.net/npm/jspanel4@4.11.1/dist/jspanel.js"></script>
		
		<script src="https://cdn.jsdelivr.net/npm/jspanel4@4.11.1/dist/extensions/modal/jspanel.modal.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/jspanel4@4.11.1/dist/extensions/tooltip/jspanel.tooltip.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/jspanel4@4.11.1/dist/extensions/hint/jspanel.hint.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/jspanel4@4.11.1/dist/extensions/layout/jspanel.layout.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/jspanel4@4.11.1/dist/extensions/contextmenu/jspanel.contextmenu.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/jspanel4@4.11.1/dist/extensions/dock/jspanel.dock.js"></script>
-->

		<script src="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/suneditor.min.js"></script>
		<!-- languages (Basic Language: English/en) -->
		<script src="https://cdn.jsdelivr.net/npm/suneditor@latest/src/lang/ko.js"></script>		

		<!------------------------>
		<!-- IODA JS            -->
		<!------------------------>

		<script src="js/ejsS/ejsS.v1.max.js"></script>
		<!--script src="js/displayed_objects/do_connection.js"></script>
		<script src="js/displayed_objects/do_graph.js"></script>
		<script src="js/displayed_objects/do_node.js"></script>
		<script src="js/displayed_objects/do_panel.js"></script-->
		
		<script src="js/graph/graph.js"></script>
		<script src="js/graph/graph_node.js"></script>
		<script src="js/graph/graph_connection.js"></script>
		<script src="js/graph/graph_run_control.js"></script>
		<script src="js/graph/graph_run_replay.js"></script>
		<script src="js/graph/graphics/graphics_constants.js"></script>
		<script src="js/graph/graphics/graphics_panel.js"></script>
		<script src="js/graph/graphics/graphics_node.js"></script>
		<script src="js/graph/graphics/graphics_connection.js"></script>

		<script src="js/resources/resources_main.js"></script>

		<script src="js/gui/gui_commands.js"></script>
		<script src="js/gui/gui_elements.js"></script>
		<script src="js/gui/gui_element_editor.js"></script>
		<script src="js/gui/gui_forms.js"></script>
		<script src="js/gui/gui_graph_edit.js"></script>
		<script src="js/gui/gui_project_list.js"></script>
		<script src="js/gui/gui_tabs.js"></script>

		<script src="js/comm/comm_listener.js"></script>
		<script src="js/comm/comm_socket.js"></script>	

	</head>
	
	<body onresize="sBrowserResized()">
		<!-------------------------------->
		<!-- Main BODY                  -->
		<!-- Defines:                   -->
		<!--  mMain[XXX] local use only -->
		<!--  sMain[XXX] global use     -->
		<!-------------------------------->
		
		<!------------------------>
		<!-- TOAST AND MODALS   -->
		<!------------------------>
		
		<div class="position-fixed top-0 start-50 translate-middle-x" style="z-index: -1">
			<div id="mMainToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
				<div class="toast-header">
					<img class="rounded me-2" src="assets/icons/atom.svg" alt="" width="24" height="24">
					<strong class="me-auto">Fusion IODA</strong>
					<small id="mMainToastHeader" class="text-muted">Message</small>
					<button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
				</div>
				<div "class="toast-body">
					<h5 id="mMainToastBody" style="padding-left:5px; color:blue">
						Hello, world! This is a toast message.
					</h5>
				</div>
			</div>
		</div>

		<script>
			var sToast = new bootstrap.Toast(document.getElementById('mMainToast'));
	
			var sShowMessage = function(header, message) {
				$('#mMainToastHeader').text(header);
				$('#mMainToastBody').text(message);
				$('#mMainToast').parent().css('z-index', 5); // Starts with -1 becasue it hided the tabs!!!
				sToast.show();
			}
			var sShowHelp = function(url) {
				$('#mMainToastHeader').text('Click for help');
				$('#mMainToastBody').text(url);
			}
		</script>
		
		<!-- MULTIUSE MODAL PAGE -->	
		<div class="modal fade" id="sMainMultiuseModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true"></div>		
		<div class="modal fade" id="sMainNameModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true"></div>		
		<div class="modal fade" id="sMainEditModal" tabindex="-1" aria-hidden="true"></div>		
		<div class="modal modal-dialog-scrollable modal-fullscreen fade" id="sMainElementEditorModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true"></div>		
		<div class="modal fade" id="sMainMessageModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true"></div>		
		<!-- END OF MULTIUSE MODAL PAGE -->	

		<!------------------------>
		<!-- LOGIN PAGE         -->
		<!------------------------>
		
		<div id="mMainLoginPage" class="d-flex flex-column h-100 text-center">
			<main class="form-signin">
				<form  method="get" onsubmit="return mMainLogin();">
					<img class="mb-4" src="assets/icons/atom.svg" alt="" width="72" height="57">
					<h1 class="h3 mb-3 fw-normal">Fusion IODA</h1>
					<label for="mMainUsername" class="visually-hidden">Username</label>
					<input id ="mMainUsername" class="form-control" placeholder="Username" type="text" required autofocus>
					<label for="mMainPassword" class="visually-hidden">Password</label>
					<input id ="mMainPassword" class="form-control" placeholder="Password" type="password" >		
					<button class="w-100 btn btn-lg btn-primary" type="submit">Sign in</button>
				</form>
			</main>
			<footer class="bg-dark text-white-50">
				<div class="col-12 container text-center">
					<small>Copyright &copy; Fusion IODA</small>
					<small class="position-absolute pe-2 end-0">
						<a href="credits.html" target="_blank" >Credits</a>
					</small>			
				</div>
			</footer>
		</div>

		<script>

			const sMainCleanLogin = function () {
				$('#mMainUsername').val("");
				$('#mMainPassword').val("");
			}

			const sMainToLoginPage = function () {
				$('#mMainLoginPage').addClass('d-flex').show(); //removeClass('collapse').addClass('collapse.show');
				$('#mMainWorkingPage').hide(); //removeClass('collapse').addClass('collapse.show');
			}
			
			const mMainToWorkingPage = function() {
				$('#mMainLoginPage').removeClass('d-flex').hide();
				$('#mMainWorkingPage').show();
			}
			
			function mMainLogin() {
				var name     = $('#mMainUsername').val();
				var password = $('#mMainPassword').val();
				sMainCommConnection.login(mMainServerWS, name, password);
				return false;
			}
			
			function mMainLogout() {
				sMainConfirmationForm.show(function(){
					sMainCommConnection.logout(); },
					"Disconnect", "Do you really want to disconnect?");
			}				
		</script>
		
		<!------------------------>
		<!-- WORKING PAGE       -->
		<!------------------------>

		<div id="mMainWorkingPage" class="d-flex flex-column col-12 h-100 mx-auto" style="display:none">
			<!------------------------->
			<!-- WORKING PAGE MAIN   -->
			<!------------------------->
			<main class="d-flex flex-column col-12 mx-auto" style="flex-grow:1;">
			
				<!------------------------->
				<!-- WORKING PAGE NAV    -->
				<!------------------------->
				<nav class="navbar navbar-fixed-top d-flex flex-row navbar-expand p-0" style="flex-grow:0; flex-basis:0">
					<div class="d-flex flex-row justify-content-start">
						<a class="navbar-brand sIODAlogo" href="#">
							<img src="assets/icons/atom.svg" alt="IODA logo" class="d-inline-block align-top">
							Fusion IODA
						</a>
						<!-----   COMMENTED OUT -----
						<button id="sMainAddTabButton" class="btn btn-link text-decoration-none p-0" type="button">
							<i class="bi bi-file-plus p-0" style="color: rgb(255, 38, 0);"></i>
						</button>
						<button id="sRenameTabButton" class="btn btn-link text-decoration-none p-0" type="button">
							<i class="bi bi-file-font p-0" style="color: rgb(255, 38, 0);"></i>
						</button>
						<button id="mMainToggleElementsButton" class="btn btn-link text-decoration-none p-0" type="button">
							<i class="bi bi-diagram-2 p-0" style="color: rgb(4, 50, 255);"></i>
						</button>
						<button id="mMainTogglePropertiesButton" class="btn btn-link text-decoration-none p-0" type="button">
							<i class="bi bi-ui-checks p-1" style="color: rgb(4, 50, 255);"></i>
						</button>
						<-----   END OF COMMENTED OUT ----->
					</div>
					<input id="mMainTitle" type="text" class="flex-grow-1 text-primary" value="Project name">
					<div class="d-flex flex-row justify-content-end">
						<!-- button class="mMainTabsMenuButton btn btn-link text-decoration-none p-0 align-middle" 
										data-action="PageNew" type="button">
							<i class="bi bi-files"></i>
						</button-->
						<div class="dropdown">
							<button id="mMainTabsMenuButton" type="button" class="p-0 btn btn-link btn-lg text-decoration-none dropdown-toggle" 
								data-bs-toggle="dropdown" aria-expanded="false">
								<i class="bi bi-layers m-0 p-0"></i>
							</button>
							<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="mMainTabsMenuButton" >
								<li class="dropdown-item mMainTabsMenuButton" data-action="PageCreate">Create a new page</li>
								<!--li class="dropdown-item mMainTabsMenuButton" data-action="GroupCreate">Create a new page group</li-->
							</ul>
						</div>					
						
						<!-- div class="dropdown">
							<button id="mMainTabsMenuButton" type="button" class="p-0 btn btn-link btn-lg text-decoration-none dropdown-toggle" 
								data-bs-toggle="dropdown" aria-expanded="false">
									<i class="bi bi-files"></i>
							</button>
							<!-- ul class="dropdown-menu dropdown-menu-end" aria-labelledby="mMainTabsMenuButton" >
								<li class="dropdown-item mMainTabsMenuButton" data-action="PageNew"   >Create a new page</li>
								<li class="dropdown-item mMainTabsMenuButton" data-action="PageCopy"  >Duplicate current page</li>
								<li class="dropdown-item mMainTabsMenuButton" data-action="PageLeft"  >Move current page to the left</li>
								<li class="dropdown-item mMainTabsMenuButton" data-action="PageRight" >Move current page to the right</li>
								<li class="dropdown-item mMainTabsMenuButton" data-action="PageRename">Rename current page</li>
								<li><hr class="dropdown-divider"></li>
								<li class="dropdown-item mMainTabsMenuButton" data-action="PageDelete">Remove current page</li>
							</ul>
						</div-->					
						<button id="mMainSaveWorkfileButton" class="btn btn-link text-decoration-none p-0 align-middle" type="button">
							<i class="bi bi-save"></i>
						</button>
						<button class="btn btn-link text-decoration-none p-0" type="button" onclick="mMainLogout();">
							<i class="bi bi-arrow-up-right-square-fill"></i>
						</button>
						<span class="border-start border-danger border-4"></span>
						<button id="mMainDeleteProjectButton" class="btn btn-link text-decoration-none p-0" type="button">
							<i class="bi bi-x-square text-danger"></i>
						</button>
					</div>
				</nav>
				
				<script>
					$("#mMainSaveWorkfileButton").on ("click",(data)=>{
							var workfileData = sTabbedPannel.saveObject ();
							var resourcesIDList = sTabbedPannel.getResourcesIDList ();
							sMainCommConnection.saveWorkfile(workfileData,resourcesIDList);
					});
					$(".mMainTabsMenuButton").on ("click",(data)=>{
							sTabbedPannel.command (data.currentTarget.dataset.action);
					});
					$("#mMainTogglePropertiesButton").click(function(){
						sTabbedPannel.toggle();
					}); 
					$("#mMainToggleElementsButton").click(function(){
						if ($('#mMainElementsPanel').hasClass('d-none'))
							$('#mMainElementsPanel').removeClass('d-none');
						else $('#mMainElementsPanel').addClass('d-none');
						sBrowserResized();
					}); 
					$("#mMainTitle").on ("change",(data)=>{
						sMainCommConnection.renameProject(data.target.value);
					});
					$("#mMainDeleteProjectButton").click(function(){
						sMainCommConnection.deleteProject();
					});
				</script>
				
				<!------------------------->
				<!-- WORKING PAGE CENTER -->
				<!------------------------->				 
				
				<div class="d-flex flex-row col-12 mx-auto" style="flex-grow:1;">
					
					<!------------------------->
					<!-- ELEMENTS SIDEBAR    -->
					<!------------------------->				 
				
					<div id="mMainElementsPanel" class="sTabLeft d-flex flex-column" style="flex-grow: 0; flex-basis:0;">
						<div class="bg-light ps-2 d-flex flex-row" style="flex-grow:0; flex-basis:0">
							<div class="sTabRight_header_title py-1" style="flex-grow:1">
									<h4 id="sMainElementsPanelTitle" class="h-100 m-0"></h4>
								</div>	
							<div class="container-fluid p-0 m-0 justify-content-end" style="flex-grow:0; flex-basis:0">
							
								<div class="dropdown">
									<button id="mMainElementMenuButton" type="button" class="p-0 btn btn-link btn-lg text-decoration-none dropdown-toggle" 
										data-bs-toggle="dropdown" aria-expanded="false">
										<i class="bi bi-layers m-0 p-0" style="font-size: 1.5rem;"></i>
									</button>
									<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="mMainElementMenuButton" >
										<li class="dropdown-item mMainElementMenuButton disabled" data-action="ElementCreate">Create a new user element</li>
										<li class="dropdown-item mMainElementMenuButton"          data-action="GroupCreate">Create a new user group</li>
									</ul>
								</div>					
							</div>
						</div>							
		 				<div id="mMainElementsSideNav" class="h-100 d-flex flex-column" style="flex-grow: 1" >
		 				</div>				
							
					</div>


					<script>
						$(".mMainElementMenuButton").on ("click",(data)=>{
							sMainElementList.userGroupCommand (data.target.dataset.action);
						});
					</script>
					 	
					<!------------------------->
					<!-- TABS CONTAINER      -->
					<!------------------------->				 
					<div id="mMainTabContainer" class="d-flex flex-column" style="flex-grow: 1">					 
					</div>
					
				</div>						

			</main>
				
			<!------------------------->
			<!-- WORKING PAGE FOOTER -->
			<!------------------------->
			<footer class="bg-dark text-white-50">
				<div class="col-12 h-100 container text-center">
					<small>Copyright &copy; Fusion IODA</small>
					<small class="position-absolute pe-2 end-0">
						<a href="credits.html" target="_blank" >Credits</a>
					</small>			
				</div>
			</footer>
			
		</div>
			
		<!-- END OF WORKING PAGE -->

		<!------------------------->
		<!-- PROJECT LIST ANCHOR -->
		<!------------------------->

		<!-- PROJECT LIST MODAL PAGE -->	
		<div class="modal fade" id="sProjectModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="projectListLabel" aria-hidden="true"></div>		
		<!-- END OF PROJECT LIST MODAL PAGE -->	

		<!------------------------->
		<!-- ELEMENTS STUFF (to be cleaned) -->
		<!------------------------->
 		

		<!---------------------------->
		<!-- FINAL SCRIPT           -->
		<!---------------------------->

		<script>
			// On resize event
			function sBrowserResized() {
				sTabbedPannel.resized();
				//setTimeout(sTabbedPannel.resized, 100);
			}

			// --- Global resources object
			
			const sMainRes = IODA_RESOURCES.main();
			//sMainRes.setLocale("es");
			
			//$('#mMainTabsMenuButton').text(sMainRes.getString("Pages"));	 

			const sMainConfirmationForm = IODA_GUI.confirmationForm();
			const sMainNameForm = IODA_GUI.nameForm();
			const sMainMessageForm = IODA_GUI.messageForm();
			/*
			var toastElList = [].slice.call(document.querySelectorAll('.toast'));
			var toastList = toastElList.map(function (toastEl) {
				return new bootstrap.Toast(toastEl);
			});
			*/
			// ------------ BEGIN COMMENTED OUT ------
			/* --- Drag utility
			const sMainDragElement = function(ev) {
				ev.dataTransfer.setData("text", ev.target.dataset.drag_info);
			}
			// --- resized!

			{ // Initialize Tooltips
				var tooltipTriggerList = [].slice.call(document
						.querySelectorAll('[data-bs-toggle="tooltip"]'))
				var tooltipList = tooltipTriggerList
						.map(function(tooltipTriggerEl) {
							return new bootstrap.Tooltip(tooltipTriggerEl)
						})
			}
			*/
			// ------------ END COMMENTED OUT ------
			
			// ------------ GLOBAL UTILITIES AND KEY OBJECTS ------

			// --- This is only valid for the local test server

			var mMainServerWS = "ws://localhost:8000/ws/ioda/guey/";
			var sMainGetServerURL = function(url) {
				if (url.startsWith('http://') || url.startsWith('https://')) return url;
				return "http://localhost:8000/static/config/" + url;
			};

			if (false) {
				mMainServerWS = "ws://localhost:8000/ws/ioda/paco/";
				sMainGetServerURL = function(url) {
					return "http://localhost:8000/config/" + url;
				};
			}

			// --- Fill Main TabContainer
			var sTabbedPannel = IODA_GUI.tabbedPanel('mMainTabContainer');
			$('#mMainTabContainer').append(sTabbedPannel.getMainPanel());

			const sMainReadWorkfile = function (workfileData) {
				sTabbedPannel.readObject(workfileData);
				mMainToWorkingPage();
			};

			const sMainSetTitle = function (title) {
				$('#mMainTitle').val(title);
			};
			
			// Create Communication Center			
			const sMainCommConnection = IODA_COMMUNICATION.SocketIODAClient();
			const sMainCommandCenter  = IODA_GUI.commandCenter();

			// Create element list
			$('#sMainElementsPanelTitle').text(sMainRes.getString("Elements"));	 
			var sMainElementList = IODA_GUI.elements();  
			$('#mMainElementsSideNav').append(sMainElementList.getMainPanel());

			// SAVES ME TIME!
			//sMainCommConnection.login(mMainServerWS, "paco", "");

		</script>		

	</body>
</html>
